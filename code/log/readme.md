# 日志系统
对于一个服务器而言，不论是在调试中还是在运行中，都需要通过打日志的方式来记录程序的运行情况。
![日志系统](https://img-blog.csdnimg.cn/img_convert/081995d0fbbcee532e60fed1c31255d8.png)
+ **同步日志**：日志写入函数与工作线程串行执行，由于涉及到I/O操作，当单条日志比较大的时候，同步模式会阻塞整个处理流程，服务器所能处理的并发能力将有所下降，尤其是在峰值的时候，写日志可能成为系统的瓶颈。

+ **异步日志**：将所写的日志内容先存入阻塞队列中，写线程从阻塞队列中取出内容，写入日志。
## 日志的运行流程：
1、使用单例模式（局部静态变量方法）获取实例Log::getInstance()。

2、通过实例调用Log::getInstance()->init()函数完成初始化，若设置阻塞队列大小大于0则选择异步日志，等于0则选择同步日志，更新isAysnc变量。

3、通过实例调用write_log()函数写日志，首先根据当前时刻创建日志（前缀为时间，后缀为".log"，并更新日期today和当前行数lineCount。

4、在write_log()函数内部，通过isAsync变量判断写日志的方法：如果是异步，工作线程将要写的内容放进阻塞队列中，由写线程在阻塞队列中取出数据，然后写入日志；如果是同步，直接写入日志文件中。
## 日志的分级与分文件：
**分级情况：**
+ Debug，调试代码时的输出，在系统实际运行时，一般不使用。
+ Warn，这种警告与调试时终端的warning类似，同样是调试代码时使用。
+ Info，报告系统当前的状态，当前执行的流程或接收的信息等。
+ Erro，输出系统的错误信息

**分文件情况：**

1. 按天分，日志写入前会判断当前today是否为创建日志的时间，若为创建日志时间，则写入日志，否则按当前时间创建新的log文件，更新创建时间和行数。
2. 按行分，日志写入前会判断行数是否超过最大行限制，若超过，则在当前日志的末尾加lineCount / MAX_LOG_LINES为后缀创建新的log文件。
